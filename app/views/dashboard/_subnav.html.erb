

<div class="event-navigation dashboard-container"> 
    <ul>
        <li> <a  class="event-sub-nav-trigger" data-target="0">  attendees  </a> </li>       
        <li> <a  class=" event-sub-nav-trigger" data-target="1" >  emails <sup>beta</sup> </a> </li>
        <li> <a  class=" event-sub-nav-trigger" data-target="2" >  settings </a> </li>
        <li>  
            

            <%= link_to event_path(@event.user_id, @event),  :target => '_blank'  do %>
            website <i class="icon icon-share-window"> </i>
            <% end %>


        </li>           
    </ul>
</div>

<!--start event subnav-->
<div class="event-actions dashboard-container owl-carousel">

    <!--start attendee section-->
    <div data-hash="attendees">

    Number of Yes replies: <%= @attendee_count %>
    Total guests: <%= @attendees.count() %>
        
   

    <%link_to 'Download', dashboard_event_path(@event) + '.csv' %>
        <% if !@attendees.empty? %>
        <table style="text-align: left;">
            <thead>
                <tr>
                    <th>Email Address</th>
                    <th>Will attend</th>  
                    <th>Guest Actions</th>  
               
                    <% if @count_registrations >= @event_registration_limit %>
                                            <th><%= link_to upgrade_path, 'add attendees', :class => 'btn btn-small' %>
</th>
                    
                    <% else %>
                        <th><a  class="btn btn-small openModal">add attendees </a></th>

                    <% end %>         

                </tr>
            </thead>

            <tbody>
                <% @attendees.each do |attendee| %>
                <tr>
                    <td><%= attendee.email %></td>
                    <% if (attendee.user_id) == current_user.id.to_s %>
                    <td> <%= attendee.attending? ? 'yes' : 'not yet replied' %></td>
                    <td>
                    
                  <!--   <%=form_for(attendee) do |f| %>
                        <%= hidden_field_tag 'attendee[attending]' , true %>
                        <%= f.submit 'submit' %>
                    <% end %> -->
                       <%= link_to 'Edit', edit_attendee_path(attendee) %> | 
                     <%= link_to 'Delete', attendee, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                    <% end %>
                </tr>
                <% end %>
            </tbody>
        </table>
        
        <% else %>
        Oh no! You don't have any attendees yet. <a class="send-email">Let's add some</a> so you can keep track of your guests and send them invitations.   
        <% end %>



    </div>
    
    
    <!--start invite section-->
    <div data-hash="invites">

        <section> 
            <h4>Choose email type </h4>
            <ul id="mail_type"> 
               <!--  <li><a href="#" data-id="2" class="active"><i class="icon icon-flag"> </i> <span>Save the Date </span></a></li>    --> 
                <li><a href="#" data-id="1" class="active"><i class="icon icon-email"> </i> <span> Invitation</span> </a></li>
                
            </ul>
        </section>


        <section> 
            <h4>Select recipients </h4>


             <% if !@attendees.empty? %>
        <table style="text-align: left;">
            <thead>
                <tr>
                    <th>Email Address</th>
                    <th>Will attend</th>  
                    <th>Send Invite?</th>  
                    <th><a  class="btn btn-small openModal">add attendees </a></th>            

                </tr>
            </thead>

            <tbody>
                <% @attendees.each do |attendee| %>
                <tr>
                    <td><%= attendee.email %></td>
                    <% if (attendee.user_id) == current_user.id.to_s %>
                    <td> <%= attendee.attending? ? 'yes' : 'not yet replied' %></td>
                    <td>
                    
                    <% end %>
                </tr>
                <% end %>
            </tbody>
        </table>
        
        <% else %>
            <p> 
                You don't have any guests yet. Get on that! <br> <a class="send-email">Let's add some attendees.</a>  
            </p>
        <% end %>

        




<!-- invitation form -->
            


        </section>

    <%= form_for :attendee,  url: attendees_send_invite_path,  :html => { :id => "send_invite" }  do |f| %>

        <%= hidden_field_tag 'event_id', @event.id%>
        <%= hidden_field_tag 'event_type2','1' %>
        <%= hidden_field_tag 'user_id', @event.user_id %> <br/>
        <%= f.submit 'Send email', class: 'btn btn-large' %>
    <% end %>
    </div>

    <!--start invite section-->
    <div data-hash="settings">

        <section> 
            <h4>Edit event details </h4>

            <!-- start event form -->
            <%= render 'form' %>
        </section>
    </div>

</div>  
<!--END event subnav-->


<!--add user modaadd-user-modall-->
<div id="add-user-modal">
    <button data-remodal-action="close" class="remodal-close"></button>
    <h2>Add attendees</h2>
     <p>
        Add your attendee email addresses (comma separated or with line breaks). 
    </p>

      <%= form_for(Attendee.new, url: attendees_invite_path) do |f| %>
  <% if Attendee.new.errors.any? %>
  <div id="error_explanation">
    <h2><%= pluralize(Attendee.new.errors.count, "error") %> prohibited this attendee from being saved:</h2>

    <ul>
      <% Attendee.new.errors.full_messages.each do |message| %>
      <li><%= message %></li>
      <% end %>
    </ul>
  </div>
  <% end %>
      <%= f.text_area :email , :class => '', :placeholder => 'Email', rows: '4' %>
      <%= hidden_field_tag 'event_id', @event.id%>
      <%= hidden_field_tag 'event_type', '1'%>
      <%= hidden_field_tag 'user_id', @event.user_id %> <br/>
      <%= f.submit "Add guests", :class => 'btn btn-primary' %>
  <% end %>



   <!-- 
    <textarea rows="4"></textarea>



    <button class="btn btn-large" data-remodal-action="confirm" class="remodal-confirm">Add attendees</button> -->
</div>



<script>

$(document).ready(function(){

    //init the remodal plugin. we have to init using js to avoid owl carousel conflict 
    var inst = $('#add-user-modal').remodal();
    $('.openModal').click(function(){
        inst.open();
    });

    $('#mail_type a').on('click', function(e) {
        e.preventDefault();
        $('#mail_type a').removeClass('active');
        $(this).addClass('active');
        $('#event_type, #event_type2').val($(this).data('id'));

    });

    //init the owl carousel plugin  
    var owl = $(".owl-carousel").owlCarousel({
        items:1,
        autoHeight : true,
        URLhashListener:true,
        startPosition: 'URLHash'   
    });
    

    switch($('.owl-item.active > div').attr('data-hash')) {
        case 'invites':
        $('.event-sub-nav-trigger[data-target="1"]').addClass('active');
        break;
        case 'settings':
        $('.event-sub-nav-trigger[data-target="2"]').addClass('active');
        break;
        default:
        $('.event-sub-nav-trigger[data-target="0"]').addClass('active');
        break;
    }


    $('.event-sub-nav-trigger').click(function(){
        
        var dest = parseInt($(this).data('target'));
        $('.event-sub-nav-trigger.active').removeClass('active');
        $(this).addClass('active');
        owl.trigger('to.owl.carousel', [dest])

    });


});
</script>