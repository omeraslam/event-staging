<div class="editor-tabs">

  <div class="editor-tools-top">

    <a class="tab toggleEditorPanel" id="editor-tool-home" data-target="editor-tool-home" style="display:none;" >
        <i class="fa fa-globe"> </i> <span> Status</span>
      </a> 
      <a class="tab toggleEditorPanel" id="editor-tool-background" data-target="editor-tool-background">
        <i class="icon icon-image"> </i> <span> Design </span>
      </a> 

      <a class="tab toggleEditorPanel" id="editor-tool-ticketing" data-target="editor-tool-ticketing" >
        <i class="icon icon-tag"> </i> <span> Registration</span>

        <% if  @account == nil && @ticket.price != 0 %>
          <div class="editor-tab-notification editor-tab-notification-error"></div>
        <% end %>



      </a>   

          <a class="tab toggleEditorPanel" id="editor-tool-details" data-target="editor-tool-details"  >
        <i class="icon icon-settings"> </i> <span> Advanced</span>
      </a>  
  </div>


    <div class="editor-tools-bottom">
      <a class="tab toggleEditorPanel" id="editor-tool-attendees" data-target="editor-tool-attendees" >
        <i class="icon icon-users"> </i> <span> Attendees</span>
      </a>


      <a class="tab toggleEditorPanel" id="editor-tool-share" data-target="editor-tool-share" style="display:none;" >
        <i class="icon icon-share"> </i> <span> Share</span>
      </a> 


      <%= link_to '<i class="icon icon-eye"> </i> <span> Preview</span>'.html_safe, slugger_path(@event), class: 'tab', target: '_blank' %>  

      <%= link_to '<i class="icon icon-sign-out"> </i> <span> go to my account </span>'.html_safe, "/", class: 'tab' %>  



    </div>


</div>



<div class="editor-container"> 

  <div class="tabs" style="display:none;">

    <a class="tab toggleEditorPanel" id="editor-tool-status" data-target="editor-tool-status" >
      <i class="icon icon-edit-inline"> </i> <span> Edit details</span>
    </a> 

    <a class="tab toggleEditorPanel" id="editor-tool-details" data-target="editor-tool-details" >
      <i class="icon icon-edit-inline"> </i> <span> Edit details</span>
    </a> 
    <a class="tab toggleEditorPanel" id="editor-tool-background" data-target="editor-tool-background">
      <i class="icon icon-image"> </i> <span> Modify background Image </span>
    </a> 
    <a class="tab toggleEditorPanel" id="editor-tool-ticketing" data-target="editor-tool-ticketing" >
      <i class="icon icon-tag"> </i> <span> Ticketing</span>
    </a>     



    <% if @event.published == false %>  

      <a class="tab" id="draft">
        <i class="icon icon-save"> </i>
        <div>Save</div>
        <span> Save</span>
      </a> 
  
      <% if @account.nil? && @has_paid_ticket %>

       <a class="tab publish" onclick="alert('You need to seet up a payment account to publish a paid ticketed event. Please add it via Stripe under ticketing settings.');">
        <i class="icon icon-globe"> </i>
        <div>Publish</div>
         <span> Publish</span>
      </a> 


      <% else %>

      <a class="tab" id="publish">
        <i class="icon icon-globe"> </i>
        <div>Publish</div>
         <span> Publish</span>
      </a> 

      <% end %>

    <% else %>  

      <a href="dashboard/event?event=<%= @event.id %>" class="tab" id="done">
        <i class="icon icon-check"> </i> 
        <div>Done</div>
        <span> Done editing</span>
      </a> 

      <div class="event-status-notification-banner visible"> 
        Just a heads up: Your website is live. Changes will be saved automatically and visible to your guests.  <a id="event-status-notification-banner-close" class="btn btn-small"> Got it, thanks. </a>   
      </div>

    <% end %>  


    <a href="dashboard/event?event=<%= @event.id %>" class="tab" id="saving">
      <i class="icon icon-loader"> </i> 
    </a> 


  </div>



  <div class="editor-tools">

    <a id="editor-panel-close" style="display:none;"><i class="icon icon-arrow-left"> </i></a>

    <div class="editor-tool" id="editor-tool-details">
    
      <section class="editor-tool-header">
        <h3>Edit event details </h3> 
        <p>Change of venue? Modify your event details below. (Don't forget to click the "update event" button when your're done.)</p>
      </section>
      <section>
          
           <%= form_for [@event] do |f| %>
            <% if @event.errors.any? %>

              <div class="alert error">
                <h2><%= pluralize(@event.errors.count, "error") %> prohibited this event from being saved:</h2>

                <ul>
                <% @event.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
                </ul>
              </div>
            <% end %>


            <div class="input-group" >
                <label> Event Name</label>
                <%= f.text_field :name, :class => 'input-primary', :placeholder => 'Mikes Birthday, etc' %>
            </div>


            <div class="input-group" id="datepairExample">
                <label> Date</label>
                <%= f.text_field :date_start, :class => 'date start input-primary', :placeholder => 'Date', :value => (@event.date_start.nil? || @event.date_start == '') ? '' : @event.date_start.to_time.strftime("%m/%d/%Y") %>
            </div>

            <div class="input-group datePairEndDates" id="datepairExample" style="display:none;">
              <div class="input-group-inline">
                <label> End Date</label>
                <%= f.text_field :date_end, :class => 'date end input-primary' , :placeholder => 'End date' %>
              </div>

              <div class="input-group-inline end-time">
                <label> End Time</label>
                <%= f.text_field :time_end, :class => 'time end input-primary' , :placeholder => 'End time' %>
              </div>
            </div>


          
            <div class="input-group">
              <label> Location Address</label>
              <%= f.text_field :location, :autocomplete => false, :class => 'input-primary controls', :id => 'pac-input', :placeholder => 'ie 10 Main Street' %>
            </div>  
              
            <div class="input-group" style="display:none;">
              <label>Event Description</label>
              <%= f.text_area :description, :class => 'input-primary', :placeholder => 'Example: Why don\'t you and your friends, get with my friends, and we can be friends!' %>
            </div>

            <div class="input-group">
              <label>Your event URL</label>
                <%= f.text_field :slug, :class => 'input-primary', :id => 'event-url-input', :placeholder => 'custom-event-url' %>
                <p>www.eventcreate.com/<span id="event-url-output"><%= @event.slug %> </span> </p>
            </div>





            <%= f.submit "Update Event", :class => 'btn btn-large' %>

           
          <% end %>

          <!-- event form end -->


      </section>

    </div>  






    <div class="editor-tool" id="editor-tool-home">
    
      <section class="editor-tool-header">
        <h3>Event Status </h3> 
        <p>View your event's website status visbility. Publish your event to share.</p>
      </section>

      <section> 
        <div class="toggle-container">
          <div class="toggle toggle-left"></div>
          <span class="toggle-text">draft</span>
        </div>

        <div class="toggle-status"><span></span> Your event was last saved at 8:00am </div>
        <div class="toggle-status"><span></span> Your event is in draft status.</div>
        <div class="toggle-status"><span></span> Your URL is inactive. </div>
        <div class="toggle-status"><span></span>Registration is inactive.</div>
      </section>

    </div>  








    <div class="editor-tool" id="editor-tool-background">

      <section class="editor-tool-header">
        <h3>Modify background image </h3> 
        <p>Make it your own. Make it amazing. Customize your event website with custom background image or color.</p>
      </section>

      <section>
        <div class="editor-current-bg upload-btn" style="background-image: url(<%= image_path(background_checker(@event, false), :width => 100) %> ) !important"> </div>
        <div class="slider-container">
          <div class="slider"> <div id="slider"></div> </div>
          <div class="color-picker"><input id="color"></div>
        </div>
      </section>

      <section>
        <a class="upload-btn btn btn-large"> <i class="fa fa-upload"> </i> Upload image </a> 
        <a class="open-image-modal btn btn-large"> <i class="fa fa-search"> </i> Search image library </a> 
      </section>

      <section style="display:none;">
        <h4>Fonts + Style</h4>
        <div class="fonts">
          <a class="font brandon" data-target="brandon" style="font">Abc </a>   
          <a class="font helvetica" data-target="helvetica">Abc</a> 
          <a class="font sophia" data-target="sophia">Abc</a>
          <a class="font futura" data-target="futura" style="font-size:22px;">Abc</a>
          <a class="font gotham" data-target="gotham" style="font-size:12px;">Abc</a>  
          <a class="font freight" data-target="freight" style="font-size:16px; letter-spacing:3px;">Abc</a>
        </div>
      </section>

    <!--CONDITIONAL HOOK FOR NON PREMIUM -->    
    <!--IF !PREMIUM -->    
  <% if current_user.customer_id.nil? && !@premium_disable %>
    <div class="editor-upgrade" style="display:none;">
      <div class="editor-upgrade-content">
      <h3>Try Pro for Free</h3>
      <p> A Pro subscription is required to white-label your website and customize the design. Try Pro now with free 7-day trial. </p>
      <a href="./upgrade" class="btn">Try Pro for Free </a>
      </div>
    </div>
  <% end %>
    <!--END -->    



    </div>  


    <div class="editor-tool" id="editor-tool-ticketing_TEMP" >
      
      <section class="editor-tool-header">
        <h3> Ticketing + Registration</h3>
        <p>Sell tickets and collect registrations for your event. (By default, we've added a free general admission ticket for you. Feel free to edit or delete that ticket.)</p>
        
        <%= link_to 'New ticket type', new_ticket_path(:event => @event) , :remote => true, :class => 'btn open-ticket' %>
        
      </section>

      <section>
        <h4>Active tickets </h4>
        <div class="tickets">
        <% @tickets.each_with_index do |ticket, index| %>
          <div class="ticket">

            <h3><%= ticket.title %></h3>
          <% if ticket.price == 0 %>
              <p>Free</p>
          <% else %>

            <p><%= number_to_currency(ticket.price) %></p>
              <% if !ticket.ticket_limit.nil? %>
                <p>Ticket limit: <%= ticket.ticket_limit %> </p>
              <% end %>
            <% end %>
            <p>Buy limit: <%= ticket.buy_limit %> </p>
            <div class="ticket-actions">
             <div class="ticket-action">
            <%= link_to ('<i class="icon icon-pencil"> </i>').html_safe, edit_ticket_path(ticket), :remote => true %></div>
            <% if @tickets.count > 1 %>
              <div class="ticket-action"> <%= link_to ('<i class="icon icon-trash"> </i>').html_safe,  ticket_path(ticket)  , method: :delete, data: { confirm: 'Are you sure?' } %>
              </div>
            <% end %>
              </div>
          </div>
        <% end %>
        </section>




        <section style="display:none;">
        <h4>Collect payments </h4>
        <p>Please connect to Stripe to sell tickets and collect payments via Visa, MasterCard or American Express. (PS, you only need to do this if you're charging for tickets.)</p>
        <% if  @account == nil %>
          <a class="stripe-connect-btn" href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= ENV['STRIPE_CLIENT_ID'] %>&scope=read_write"><img src="/assets/stripe/blue-on-light.png" /> </a>
        <% else %>
          User has connected to stripe
        <% end %>
        </section>

    </div>  






      <div class="editor-tool" id="editor-tool-ticketing" >
        
        <section class="editor-tool-header">
          <h3> Ticketing + Registration</h3>
          <p>Sell tickets and collect registrations for your event. </p>
        </section>




                <section style="display:none;" >
        <h4>Collect payments </h4>
        <p>Please connect to Stripe to sell tickets and collect payments via Visa, MasterCard or American Express. (PS, you only need to do this if you're charging for tickets.)</p>
        <% if  @account == nil %>
          <a class="stripe-connect-btn" href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= ENV['STRIPE_CLIENT_ID'] %>&scope=read_write"><img src="/assets/stripe/blue-on-light.png" /> </a>
        <% else %>
          User has connected to stripe
        <% end %>
        </section>


        <section>


        <% if  @account == nil && @ticket.price != 0 %>
          <div class="well well-error">
         Get paid! Please add a bank account to accept payments. <a class="stripe-connect-btn" href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= ENV['STRIPE_CLIENT_ID'] %>&scope=read_write">Add account </a>
          </div>

                  <% end %>

<%= form_for [@ticket] do |f| %>



    <div class="input-group input-group-addon">
      <label> Price</label>
      <div class="input-addon">$</div><%= f.number_field :price, class: 'input input-large', id: 'event-price-input', placeholder: '0.00', disabled: @account.nil?  %> 

        <% if  (!@account == nil)%>

      <p id="input-free-event-container">   <input type="checkbox"  <% if @ticket.price == 0 %> checked <% end %> id="free-event-boolean"><label for="free-event-boolean"> My event is FREE.</label> </p>

                  <% end %>


    </div>
  
    
    <div class="input-group" id="datepairExample">
        <label> Regisration closes on</label>
 <%= f.text_field :stop_date, :class => 'date start input-primary', :placeholder => 'Date', :tabindex => "-1" %>
    </div>





      <div class="input-group">
        <label> Event capacity</label>
        <%= f.number_field :ticket_limit, class: 'input input-large', placeholder: '∞' %>
      </div>

            <div class="input-group">
        <label>Buy Limit</label>
        <%= f.number_field :buy_limit, class: 'input input-large', placeholder: '1' %>
        <p>Limit the ticket quantity that a user can buy at one time.</p>
      </div>





    <div class="input-group" style="display:none;">
      <label>Tickets available until</label>
      <%= f.date_select :stop_date, class: 'input input-large'%>
    </div>

<div class="input-group actions">
   <%= f.submit 'Update registration settings', class: 'btn btn-large' %>
 </div>
 <% end %>


          </section>



      </div> 









    <div class="editor-tool" id="editor-tool-attendees" >
        
        <section class="editor-tool-header">
          <h3> Attendees</h3>
          <p>Manage your event registration, attendees and ticket buyers.  </p>
          <p>  <%= link_to 'Download ', dashboard_event_path(:event => @event.id, :format => :csv), class: '' %> |
        <%= link_to 'Print ', dashboard_print_path(:event => @event.id), class: '' %></p>
        </section>



        <section class="attendees"> 
          <% if !@attendees.empty? %>


              <ul>
                <% @attendees.each do |attendee| %>
                <li>
                  <img src="https://www.keita-gaming.com/assets/profile/default-avatar-c5d8ec086224cb6fc4e395f4ba3018c2.jpg"> 
                    <div class="attendee-details">
                      <a href="mailto:<%= attendee.email %>"> <%= attendee.first_name %> <%= attendee.last_name %> </a> 
                      <b> (+1) </b><br>
                      <%= link_to 'Delete', attendee, class: 'attendee-delete', method: :delete, data: { confirm: 'Are you sure? This cannot be undone' } %>
                    </div>
                </li>
                <% end %>
              </ul>

              
              <% else %>
              <div class="empty">
                  <h2>No attendees, just yet.  </h2>
              </div>
              <% end %>


        </section>



      </div> 




    <div class="editor-tool" id="editor-tool-share" >
        
        <section class="editor-tool-header">
          <h3> Share tools</h3>
          <p>You've made an beautiful event website. Now it's time to share it with the world!</p>
        </section>






      </div> 









  </div>
</div>




<div id="event-saved-modal">
  <button data-remodal-action="close" class="remodal-close"></button>

  <div class="modal-header modal-header-light">
    <h2>Saved.</h2>
    <p> Rest easy; your event website was successfully saved. If you're finished editing, be sure to publish your event to make it live! </p>
  </div>
  <div class="modal-body">
      <a href="dashboard/event?event=<%= @event.id %>" class="btn btn-block btn-subtle"><i class="icon icon-home"></i>Back to my event dashboard </a>
      <%= link_to '<i class="icon icon-website"></i> Preview my website (new window)'.html_safe, slugger_path(@event), class: 'btn btn-block btn-subtle', target: '_blank' %>  
      <a href="dashboard/event?event=<%= @event.id %>" class="btn btn-block"><i class="icon icon-globe"></i> Publish my event! </a>
  </div>
</div>




 <!--TEMP HOLDER FOR DRAG AND DROP ELEMENTS-->
  <a href="#" id="custom-image" style="display:none;">

  <div class="upload" style="background-image:url('<%= @event.background_img%>')">  </div> 

    <script id="template-upload" type="text/x-tmpl">
    <div class="uploader">
    <div class="progress"><div class="bar" style="width:0%;"></div></div>
    </div>
    </script>

  </a> 


<div id="stripe-modal" style="min-width:540px;">
  <div class="modal-header modal-header-light">
    <button data-remodal-action="close" class="remodal-close"></button>
    <h3 style="margin-bottom:20px;">  Nice! So you're selling tickets? Let's figure out how you want to get paid.</h3>
     <p>EventCreate partners with Stripe to process payments, so <u> <b> you get paid immediately</b></u>.</p> <p> Please head over to Stripe and add your payment details before you start selling tickets. You'll be redirected back to EventCreate automatically. It's easy and only takes a minute. </p>


       <% if  @account == nil %>
          <a class="stripe-connect-btn" href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= ENV['STRIPE_CLIENT_ID'] %>&scope=read_write"><img src="/assets/stripe/blue-on-light.png" /> </a>
      <% end %>



  </div>
  <div class="modal-body">
   




  </div> 
</div>




<script src="/assets/vendor/jquery.minicolors.min.js"></script>
<script type="text/javascript">







$( document ).ready(function() {

  //rsvp dropdown
  $('#purchase-tickets_form select').on('change', function(){
    alert('hey');
    $('.form-quantity').text($(this).val());
  });

  $(".toggle-container").click(function() {   
      $(this).toggleClass("toggle-on");
      $(this).find("span").text("live");
  });




  //TICKET - new ticket modal functionality and validation
  $("#show-event-description").click(function() {  
    $(this).hide();
    $("#ticket-description").slideDown();
  });
  $("#show-ticket-advanced-settings").click(function() {  
    $("#ticket-advanced-settings").slideToggle();
  });
  var validator = $("#new_ticket").validate({
    rules: {
      name: "required",
      "ticket[title]": {
        required: true
      }
    }, messages : {
      "ticket[title]": 'Please enter a ticket name.'
    }
  });

  //prevent new paid ticket submission if no account set up 
  $('#new_ticket .btn').on('click', function(e) {

    if($('#ticket_price').val() > 0 && $('.stripe-connect-btn').length > 0) {

      e.preventDefault();
      alert('Please enter a payment account to create paid tickets for this event.')

    } 

  });




  //INTRO - slide in the editor tabs
  setTimeout(function(){  
    $('.tabs').addClass("visible");
  }, 500);











  //EDITOR - set size of panel
  $('.editor-tools').css("height",$(window).height());
  $( window ).resize(function() {
    $('.editor-tools').css("height",$(window).height());
  });

  //EDITOR -  editor panel interaction behaviors
  $('.toggleEditorPanel').click(function() {

    var active = $(this).hasClass('active');
    var target = $(this).data('target');
    $('.toggleEditorPanel.active').removeClass("active");
    if (!active) {
      $(".editor-tool").hide();
      $(".editor-tool#" + target).show();
      $(this).addClass("active");
      $(".editor-container").addClass("visible");
    } else {
      $(this).removeClass("active");
      $(".editor-container").removeClass("visible");
    }
  });

  $('#editor-panel-close').click(function() {
    $(".toggleEditorPanel.active").removeClass("active");
    $(".editor-container").removeClass("visible");
   });





  //EDITOR - set values
  var published = $('#published').val()? $('#published').val(): "false"; 
  var currentFont = $('#font_type_id').val()? $('#font_type_id').val(): "brandon"; 
  var currentBgOpacity = $('#bg_opacity').val()? $('#bg_opacity').val(): ".5"; 
  var currentBgColor = $('#bg_color').val()? $('#bg_color').val(): "#222"; 
  var currentBg = $('#external_image').val(); 
  var currentBgLoaded = $('#bg').val()? $('#bg').val(): ''; 
  var currentShowCustom = $('#show_custom').val(); 
  var newFont;
  var newBgOpacity;
  var newBgColor;
  var newShowCustom;
  var newBg;
  var tempFont = currentFont;
  var changesExist = false;

  var layout = $('#layout_id').val()? $('#layout_id').val(): "1"; 
  var theme = $('#layout_style').val()? $('#layout_style').val(): "brunch";   
  var htmlHeroOne; 
  var htmlHeroButton; 
  var htmlBodyOne;
  var htmlFooterOne;
  var htmlFooterButton;




  //TICKETING - add ticket modal
  var ticketModal = $('#ticket-modal').remodal();
  // $('.open-ticket').click(function(e){
  //   ticketModal.open();
  //   e.preventDefault;
  // });


  //IMAGES - search unsplash
  var imageModal = $('#image-search-modal').remodal();
  $('.open-image-modal').click(function(e){
      e.preventDefault();
      imageModal.open();
  });

  $("#bgSearchTerm").keyup(function (e) {
      if (e.keyCode == 13) {
           $('.search-btn').click();
      }
  });

  $('.search-btn').on('click', function(e) {
      e.preventDefault();
      var searchTerm = $('#bgSearchTerm').val();
      var url = String(window.location.href).replace('?editing=true', '').replace('#', '') + '/unsplash-search';

      $.ajax({
            url: url,
            data: {searchTerm: searchTerm},
            success: function(data) {
              var photoArray = [];

              $('.image-results ul').empty();

              for(var i=0;i<data.length;i++) {
                  var list_image = '<li><img src="'+ data[i].attributes.table.urls.thumb +'"/></li>';
                  photoArray.push(data[i].attributes.table.urls.full);

                  $('.image-results ul').append(list_image);
              }
              $('.image-results ul li').off('click');
              $('.image-results ul li').on('click', function(e) {
                  e.preventDefault();
                  imageModal.close();
                  $('.event-page').attr('style','background-image: url('+photoArray[$(this).index()]+') !important' );

                  $('.editor-current-bg').css('background-image', 'url('+ photoArray[$(this).index()] +')');
                  $('#bg').val(photoArray[$(this).index()]);
                  $('#show_custom').val(true);
                   requestEdit({bg_img:photoArray[$(this).index()]});
                   requestEdit({show_custom:true});
              })

            },
            error: function(data) {
              $('.image-results ul').append('<li>No results found</li>')
            }
      });

  });
  //--end unsplash modal    
  




  //EDITOR - detect changes
  function requestEdit(feature) {

    if(feature.bgOpacity) {
        newBgOpacity = feature.bgOpacity; 
        if (newBgOpacity != currentBgOpacity) {
             saveChanges();
        }
    }


    if(feature.bgColor) {
        newBgColor = feature.bgColor; 
        if (newBgColor != currentBgColor) {
          saveChanges();
        }
    }


    if( feature.font) {
        console.log(feature.font);
        newFont = feature.font; 
        if (newFont != currentFont) {
            saveChanges();
        }
    }

    if( feature.bg_img) {
        console.log(feature.bg_img);
        newBg = feature.bg_img;
        if (newBg != currentBg) {
            currentBgLoaded = '';
            $('#external_image').val(newBg)
            newShowCustom = true;
            saveChanges();

        }
    }

    if( feature.show_custom) {
        console.log(feature.show_custom);
        newShowCustom = feature.show_custom;
        if (newShowCustom != currentShowCustom) {     
          saveChanges();
        }
    }      

  }




  //backgroud opacity slider
    $(function() {
      $( "#slider" ).slider({
        value: (currentBgOpacity != undefined) ? currentBgOpacity*100 : 0,
        slide: function( event, ui ) { 

          var percentage = ui.value/100;
          $(".event-page .overlay").css("opacity", percentage);
          requestEdit({bgOpacity:percentage});
        }
      });
    });


  //background color picker
    $('input#color').minicolors({ 
      position: 'top right', 
      defaultValue: currentBgColor,
      change: function(value, opacity) {
          $(".event-page .overlay").css("background-color", value);
          requestEdit({bgColor:value});

      }
   });

  //change font
  $('.font').click(function() {
      var target = $(this).data('target');
      $('.event-container').removeClass(tempFont); 
      $('.event-container').addClass(target); 
      requestEdit({font:target});
      tempFont = target;

 });







  //EDITOR -  event saved modal
  var eventSavedModal = $('#event-saved-modal').remodal();
  $('#draft').click(function(e){
    $(".full-page-loader.saving").addClass("visible");
    setTimeout(function(){  
      eventSavedModal.open();
      $(".full-page-loader.saving").removeClass("visible");
    }, 1500);

    e.preventDefault;
  });



  //manage ticketing price input (to check if stripe account exists)
  var stripemodal = $('#stripe-modal').remodal();

  $('#free-event-boolean').click(function(e) {
      
      if($(this).is(":checked")) {
        $("#event-price-input").attr("disabled", true);

      } else {

          if($('.stripe-connect-btn').length > 0) {
              
              stripemodal.open();
              e.preventDefault();
              return false;

          } else {
              $("#event-price-input").attr("disabled", false); 
          }

        }
  });




  // publish button 
  $('#publish').click(function(e) {
    e.preventDefault();

    $(".full-page-loader.saving").addClass("visible");
    $(".tabs").removeClass("visible");
    
    var eventProperties = {}
    eventProperties.name = $('h1 span').text();
    eventProperties.slug = window.location.href.split('?editing=true')[0];
    eventProperties.slug = eventProperties.slug.split('/')[3];
    eventProperties.type = $('#layout_style').val();
    var event_id = 'step 4 success - publishing event';
    amplitude.logEvent(event_id, eventProperties);  

    published = true;    
    saveChanges(true);



  });


$(function() {
    $('.froala-editor').froalaEditor({
      toolbarInline: true,
      charCounterCount: false,
      toolbarButtons: ['bold', 'italic', 'underline', 'fontSize', 'strikeThrough', 'color', 'emoticons', '-', 'paragraphFormat', 'align', 'formatOL', 'formatUL', 'indent', 'outdent', '-', 'insertImage', 'insertLink', 'insertFile', 'insertVideo', 'undo', 'redo'],
      linkStyles: {
        btn: 'Button'      }
    }).on('froalaEditor.contentChanged', function (e, editor) {


      htmlHeroOne = $("#htmlHeroOne").froalaEditor('html.get');
      //htmlHeroButton = $("#htmlHeroButton").froalaEditor('html.get');
      htmlBodyOne = $("#htmlBodyOne").froalaEditor('html.get');
      htmlFooterOne = $("#htmlFooterOne").froalaEditor('html.get');
      //htmlFooterButton = $(this).froalaEditor('html.get');

      saveChanges();

});
});

//photo-1443130128240-22fb98ca70a4?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&s=e5ef277d1a5f81a1fc520243664aa7cf

  function saveChanges(callBack) {

    newBg = $('#external_image').val()
    $.ajax({
      type: 'POST',
        url: String(window.location.href).replace('?editing=true', '').replace('#', '') + '/updatetheme_post', //testing
        data: {event:{layout_id: layout, published: "true", layout_style: theme, bg_color: newBgColor , bg_opacity: newBgOpacity, font_type: newFont, external_image: newBg, show_custom: newShowCustom, html_hero_1:htmlHeroOne, html_hero_button:htmlHeroButton, html_body_1:htmlBodyOne, html_footer_1:htmlFooterOne, html_footer_button:htmlFooterButton      }},
    beforeSend: function(){
        
        changesExist = true;
        $("#saving").addClass("visible");
    }
      }).done(function(data){
        //console.log(data);
        $('#layout_style').val(theme);
        changesExist = false;
        $("#saving").removeClass("visible");


        if (callBack) {
          window.location.href = "dashboard/event?event=<%= @event.id %>";
        } else {
          
        }

      });
    }

  });



  //warning before leave page
  window.onbeforeunload = function(e) {
    if(changesExist) {
      return 'You have unsaved pages. Please wait until we have finished saving your event';
    }
  };

  $('.upload-btn').on('click', function(){
    $('.file-label').click();
  });

  //EDITING - close the "editing live events" notifcation banner 
  $("#event-status-notification-banner-close").click(function(e) {
    e.preventDefault();
    $(".event-status-notification-banner").removeClass("visible");

  });
  var $form = $('#background_form');
  $form.on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {
    e.preventDefault();
    e.stopPropagation();
  })
  .on('dragover dragenter', function() {
    $form.addClass('is-dragover');
  })
  .on('dragleave dragend drop', function() {
    $form.removeClass('is-dragover');
  })
  .on('drop', function(e) {
    droppedFiles = e.originalEvent.dataTransfer.files;
  });





</script>

