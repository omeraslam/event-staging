<% title @event.name %>
<% meta_description 'Create stunning websites in seconds.' %>
<div class="show-container <%= (signed_in? && current_user.id == @user.id)? 'user' : '' %>">
    


  
<%= render 'events/partials/eventwebsite' %>

<% if signed_in? && current_user.id == @user.id %>
  <%= render 'events/partials/eventinvite' %>
  <%= render 'editor' %>
  <%= render 'partials/fullpage_loader' %>
  <%= render 'partials/linkmodal' %>

<%= render 'partials/imagesearch' %>  <!-- unsplash image search modal -->
<%= render 'dashboard/emailmodal' %>
<% end %>



  <%= render 'events/partials/contact_form' %>
  <%= render 'events/partials/rsvp_form' %><!-- 
  <%= render 'events/partials/confirmation_form' %> -->

  <%= render 'dashboard/eventsuccessmodal' %>
</div>



<script src="/assets/vendor/jquery.minicolors.min.js"></script>


<script type="text/javascript">

$( document ).ready(function() {

  var validator = $("#new_attendee").validate({
    rules: {
      name: "required",
      "attendee[first_name]": {
        required: true
      },
      "attendee[last_name]": {
        required: true
      },
      "attendee[email]": {
        required: true
      } 

    },
    messages : {
      "attendee[first_name]": 'Please enter your first name',
      "attendee[last_name]": 'Please enter your last name',
      "attendee[email]": 'Please enter your email'
    }
  });

  $('.event-editor-background .image').removeClass().addClass('image '+ $('#layout_style').val());
  $("#event-share").click(function() {
   $(".event-share").toggle();
 });
  //$("#share-url").val(window.location.href); 
  $("#email-share").attr("href", "mailto:?subject=Join me at my event&body=Join me at my event. Register now at " +  $('#share-url').val() ); 
  $("#twitter-share").attr("href", "http://twitter.com/home?status=Join me at my event. Register now at " +  $('#share-url').val() ); 

  $(".theme").click(function() {
   var theme = $(this).data("theme");
   $(".event-container").addClass(theme);
   if($('.event-editor-background > a.default.highlight').length > 0) {
    $('.event-page').css('background-image', '')
  }

  $('.event-editor-background .image').removeClass().addClass('image '+theme);


});

	//startIntro();

    //contact host modal
    var contactModal = $('#contact-modal').remodal();
    $('.open-contact').click(function(e){
    	contactModal.open();
      e.preventDefault;
    });

		//registration modal
		var registrationModal = $('#attendee-form').remodal({hashTracking:false});
		$('.open-registration').click(function(){
			registrationModal.open();
		});

    $('#view-switch').click(function(e){
      $(".dropdown-menu").toggleClass("visible");
    });



    $("#view-website").hide();

    $('#view-invite').click(function(e){
        
        $(".dropdown-menu").removeClass("visible");
        $(".full-page-loader").addClass("visible").delay(1000).removeClass("visible", function() {
          $(".show-view").hide();
          $(".show-view.invite-container").show();
          $("#view-switch").html("Previewing invite <i class='icon icon-arrow-down'></i>");
          $("#view-website").show();
          $("#view-invite").hide();
          $("body").addClass("invite-view");

      });
    });


    $('#view-website').click(function(e){
        
        $(".dropdown-menu").removeClass("visible");
        $(".full-page-loader").addClass("visible").delay(1000).removeClass("visible", function() {
          $(".show-view").hide();
          $(".show-view.website-container").show();
          $("#view-switch").html("Previewing website <i class='icon icon-arrow-down'></i>");
          $("#view-invite").show();
          $("#view-website").hide();
          $("body").removeClass("invite-view");

      });
    });






  //confirmation  modal
  var confirmationModal = $('#attendee-confirmation-form').remodal();
    
    



  //UI for navigation panel
  $('.toggleEditorPanel').click(function() {

   var active = $(this).hasClass('active');
   var target = $(this).data('target');
   $('.toggleEditorPanel.active').removeClass("active");

    if (!active) {

      $(".editor-tool").hide();
      $(".editor-tool#" + target).show();
      $(this).addClass("active");
      $(".editor-container").addClass("visible");

    } else {

      $(this).removeClass("active");
      $(".editor-container").removeClass("visible");

    }

 });



  //set current page editor variables
  var currentFont = "brandon";
  var currentBgOpacity = ".5";
  var currentBgColor = "#222";

  var newFont;
  var newBgOpacity;
  var newBgColor;

  var tempFont = currentFont;

  var changesExist = false;


  function requestEdit(feature) {

    if(feature.bgOpacity) {
        newBgOpacity = feature.bgOpacity; 
        if (newBgOpacity != currentBgOpacity) {
            console.log("opacity change");
            $(".edit-save").fadeIn();
            changesExist = true;

        }
    }


    if(feature.bgColor) {
        newBgColor = feature.bgColor; 
        if (newBgColor != currentBgColor) {
            console.log("color change");
            $(".edit-save").fadeIn(); 
            changesExist = true;

        }
    }


    if( feature.font) {
        console.log(feature.font);
        newFont = feature.font; 
        if (newFont != currentFont) {
            console.log("font change");
            $(".edit-save").fadeIn(); 
            changesExist = true;

        }
    }    

  }


  //backgroud opacity slider
    $(function() {
      $( "#slider" ).slider({
        slide: function( event, ui ) { 
          var percentage = ui.value/100;
          $(".event-page .overlay").css("opacity", percentage);
          requestEdit({bgOpacity:percentage});
        }
      });
    });

  //background color picker
    $('input#color').minicolors({ 
      position: 'top right', 
      change: function(value, opacity) {
          $(".event-page .overlay").css("background-color", value);
          requestEdit({bgColor:value});

      }
   });

  //change font
  $('.font').click(function() {
      var target = $(this).data('target');
      $('.event-container').removeClass(tempFont); 
      $('.event-container').addClass(target); 
      requestEdit({font:target});
      tempFont = target;

 });



  // save button 
  $('#save').click(function(e) {
    e.preventDefault();
    $(".editor-container").removeClass("visible");
    $(".tab.active").removeClass("active");
    $(".edit-save").fadeOut();
    saveChanges();
  });


  // discard changes 
  $('#discard').click(function(e) {
    
    $(".editor-container").removeClass("visible");
    $(".tab.active").removeClass("active");
    $(".edit-save").fadeOut();
    
    $('.event-container').removeClass(newFont); 
    $('.event-container').removeClass(tempFont); 
    $('.event-container').addClass(currentFont); 

    $(".event-page .overlay").css("opacity", currentBgOpacity);
    $(".event-page .overlay").css("background-color", currentBgColor);

    newFont = null;
    newBgOpacity = null;
    newBgColor = null;

    changesExist = false;


  });





  //warning before leave page
  window.onbeforeunload = function(e) {
    if(changesExist) {
      return 'You have unsaved pages. Do you want to leave this page without saving?';
    }
  };

  function saveChanges() {
    $.ajax({
      type: 'POST',
        url: String(window.location.href).replace('?first=true', '').replace('#', '') + '/updatetheme_post', //testing
        data: {event:{layout_id: layout, layout_style: theme}}
      }).done(function(data){
        console.log(data);
        $('#layout_style').val(theme);
        changesExist = false;

      });
    }

  });













  //LOAD THE THEME AND CONSTRUCT

  var theme = $('#layout_style').val()? $('#layout_style').val(): "brunch";   
  var layout = $('#layout_id').val()? $('#layout_id').val(): "1"; 


  $('.theme.active').removeClass("active");
  $('.event-container').removeClass(theme); 
  $('.event-page.' + layout).removeClass('visible'); 

  $('.theme#' + theme).addClass("active");


  $('.event-container').addClass(theme); 
  $('.event-page.' + layout).addClass('visible');    


  $('.theme').click(function() {


    $('.theme.active').removeClass("active");
    
    $('.event-container').removeClass(theme); 

    $(this).addClass('active'); 
    layout = $(this).data('layout'); 
    theme = $(this).data('theme'); 



    if($('#layout_style').val() !== theme   ) {
      $('.save-btn').show();
    }
    
    $('.event-container').addClass(theme); 

    return false;

  });







    var emailInviteModal = $('#email-invite-modal').remodal();
  
    $('.open-link-modal').click(function(){
      //  linkModal.open();
        emailInviteModal.open();

    });

</script>

