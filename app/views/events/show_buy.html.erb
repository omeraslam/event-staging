

<% title @event.name.html_safe %>
<% meta_description 'Create stunning websites in seconds.' %>
<div class="show-container buy-container">
  <div class="event-page 1 visible event-buy-page" style="background-image: url(<%= image_path(background_checker(@event, false), :width => 100) %> ) !important">
    <div class="overlay" style="opacity: <%= @event.bg_opacity %>;background-color:<%= @event.bg_color %>;"></div>
    <div class="header"> 
     <h2 class="hidden"> <%= @event.name %></h2>
   </div>
 </div> 
 <div class="confirm-container">
  <div class="breadcrumbs">1. <a href="">Ticket</a> 2. <a href="">Payment</a></div>
  <h2><%= @event.name %> </h2>
  <p><%= @event.date_start.to_date.strftime("%B") %> <%= @event.date_start.to_date.strftime("%e, ") %> <%= @event.date_start.to_date.strftime("%Y") %></p>
  <%= form_tag complete_registration_path, :id => 'purchase-tickets_form' do |f|  %>
  <% if @purchase.errors.any? %>
  <div class="alert error">
    <h2><%= pluralize(@purchase.errors.count, "error") %> prohibited this event from being saved:</h2>
    <ul>
      <% @purchase.errors.full_messages.each do |message| %>
      <li><%= message %></li>
      <% end %>
    </ul>
  </div>
  <% end %>
  <div class="ticket-list-container">
    <% @tickets.each do |ticket| %>
    <div class='ticket-container'>
      <h4><%= ticket.title %></h4>
      <small><%= ticket.description %></small>
      <%= select_tag "ticket_quantity["+ticket.id.to_s+']', options_for_select((1..ticket.buy_limit).step(1)) %>
    </div>
    <% end %>
    <%= hidden_field_tag :user_id, @user.id  %>
    <%= hidden_field_tag :event_id, @event.id  %>
    <% end %>
    <!-- END modal -->
  </div>
  <a class="btn">Continue</a>
</div>






<!-- WHAT THE HECK -->


<% title @event.name.html_safe %>
<% meta_description 'Create stunning websites in seconds.' %>
<div class="show-container buy-container">



    <div class="event-page 1 visible event-buy-page" style="background-image: url(<%= image_path(background_checker(@event, false), :width => 100) %> ) !important">
      
      <div class="overlay" style="opacity: <%= @event.bg_opacity %>;background-color:<%= @event.bg_color %>;"></div>

      <div class="header"> 
         <h2> <%= @event.name %></h2>
         <p><%= show_proper_date(@event, true) %> </p>        
      </div>

    </div> 


   
  <div class="event-purchase-form"> 

    <div class="purchase-details">
      <h3> Order Summary</h3>
      <% ticket_array = @line_items.group(:ticket_id).count %>
      <% ticket_array.keys[0] %>
      <table> 
      <% 
      sum = 0 %>
      <% (0..(ticket_array.count-1)).each do |i| %>
      <% if ticket_array.values[i].to_i != 0 %>
      <tr>
     <% 
      @ticket_item = Ticket.where(:id => ticket_array.keys[i].to_i).first %>

      
        <td class="ticket-quantity"><h4> <%= @ticket_item.title %> X <%= ticket_array.values[i].to_i %></h4> <p><%= number_to_currency(@ticket_item.price) %> </p></td>
        <td class="ticket-amount"> <%= number_to_currency(ticket_array.values[i].to_i * @ticket_item.price.to_i) %> </td>
      </tr>
      <% sum += (ticket_array.values[i].to_i * @ticket_item.price.to_i) %>
      <% end %>
      <% end %>



      </table>

      <table> 
      <tr>
        <td><h4> Total </h4></td>
        <td class="ticket-amount"> <%= number_to_currency(sum) %></td>
      </tr>

      </table> 


    </div>


<%= form_tag complete_registration_path, :id => 'purchase-tickets_form' do  %>

<%= hidden_field_tag :oid, @purchase.id  %>
<%= hidden_field_tag :user_id, @user.id  %>
<%= hidden_field_tag :event_id, @event.id  %>
<%= hidden_field_tag :purchase_amount, @final_charge  %>




      <h2> Ticket Buyer</h2> 

      <div class="input-group"> 
        <div class="input-group-inline">
          <label> First Name </label>
          <input type="text" name="purchase[first_name]" placeholder="First Name"/> 
        </div>

        <div class="input-group-inline">
          <label> Last Name </label>
          <input type="text"  name="purchase[last_name]"  placeholder="Last Name" /> 
        </div>
      </div>

      <div class="input-group"> 
        <div class="input-group-inline">
          <label> Email Address </label>
          <input type="text" name="purchase[email]" placeholder="email@email.com" /> 
        </div>

        <div class="input-group-inline">
          <label> Phone Number (optional) </label>
          <input type="text" name="purchase[phone_number]" placeholder="(555) 555-5555"  /> 
        </div>
      </div>      



      <h2> Ticket Holder(s)</h2> 
    <% tick_num = 1 %>
    <% @line_items.each do |line_item| %>
      
       <div class="ticket-holder">
          <h4> <% @ticket = Ticket.where(:id => line_item.ticket_id.to_i).first %> <%= @ticket.title %> - Ticket <%= tick_num %> </h4>
          <div class="ticket-buyer-form">
            
            <div class="input-group"> 
              <div class="input-group-inline">
                <label> First Name </label>
                <input type="text" name="attendees[<%= tick_num %>][first_name]" placeholder="First Name" /> 
              </div>

              <div class="input-group-inline">
                <label> Last Name </label>
                <input type="text" name="attendees[<%= tick_num %>][last_name]" placeholder="Last Name"  /> 
              </div>
            </div>



          <div class="input-group"> 
            <div class="input-group-inline">
              <label> Email Address </label>
              <input type="text"  name="attendees[<%= tick_num %>][email]" placeholder="email@email.com"/> 
            </div>
          </div>

          </div>  
      </div>

      <%= hidden_field_tag "attendees["+ (tick_num.to_s)+"][line_id]", line_item.id  %>
      <% tick_num += 1 %>
  

    <% end %>

      


<% if @final_charge != 0 %>

    <h2> Payment</h2> 

    <div class="ticket-purchase">

          <div class="input-group">
            <label>Credit card number</label>
            <input  type="text" id="cc" placeholder="5555 5555 5555 5555" class="input input-large cc-number" >
            <p>We  accept Visa, Mastercard and American Express credit cards.</p>
            
          </div>
          
          <div class="input-group">
            <div class="input-group-inline">   
              <label>Expiration (month/year)</label>
              <input placeholder="12 / 2018" class="input cc-exp" type="text" > 
            </div>
            <div class="input-group-inline" id="cvv"> 
              <label>CVV</label>
              <input class="input cc-cvc" type="text" placeholder="CVV" maxlength="4"  >
            </div>
          </div>  

    </div>


    <div class="input-group">
        <p> By clicking <%= !@account.nil? ? "Pay Now" : "Complete Registration" %>, I acknowledge that I have read and agree with the EventCreate terms of service, privacy policy, and cookie policy.</p>
    </div>

<% end %>

    <div class="input-group">
    <button class="btn btn-large"><%= !@account.nil? ? "Pay Now" : "Complete Registration" %> </button>

    </div>








<% end %>


  </div>  
    

<div class="credit"> 
  <div>Event websites by </div> 
  <a href="/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 794 117.6" class="logo-svg"><path d="M108.8 0.3c0 4.6 0 8.3 0 13.1 -17 0-33.7-0.2-50.4 0.1C39.5 13.8 25.8 23 17.9 39.9 9.9 56.8 11.7 73.2 23.3 88c8.2 10.5 19.4 16.2 32.8 16.4 12.9 0.2 25.8 0 39.3 0 0-4.4 0-8.4 0-13.3 -11.7 0-23.5 0.1-35.2 0C39.5 91.1 25 78.3 24.8 60c-0.1-19.4 14.5-33.3 35.2-33.4 15.9-0.1 31.9-0.1 48.4-0.1 0 13.2 0 25.9 0.1 39.2 -17.8 0-35.5 0.1-53.7 0.1 0-3.9 0-7.7 0-12.3 13.2 0 26.5 0 40.5-0.1 0-4.8 0-8.7 0-13.5 -13.5 0-27.3-0.6-40.9 0.3 -9.8 0.6-17 10.8-16.3 20.7 0.7 9.3 8.2 16.6 18.3 16.8 14.3 0.3 28.6 0.1 43 0.1 3 0 6 0 9.4 0 0 13.2 0 25.8 0.1 39.7 -6 0-12.2 0.2-18.4 0 -15.1-0.4-30.5 0.8-45.3-1.7C17 111-1.7 84.6 0.1 55.3 1.9 26.7 24.7 2.2 52.6 0.6 71-0.5 89.5 0.3 108.8 0.3z" class="a"/><path d="M190.7 37.9h25.8v8.7h-15.7v7.5h12.6v8.6h-12.6v7.8h16.6v8.7h-26.6V37.9z" class="a"/><path d="M240.6 37.9h11l7.3 23.5c0.8 2.6 1.6 6.6 1.6 6.6h0.1c0 0 0.8-4 1.6-6.6l7.4-23.5h10.8l-14.5 41.2h-10.5L240.6 37.9z" class="a"/><path d="M305.8 37.9h25.8v8.7h-15.7v7.5h12.6v8.6h-12.6v7.8h16.6v8.7h-26.6V37.9z" class="a"/><path d="M360.9 37.9h10.2l11.4 19.3c1.6 2.7 3.5 7 3.5 7h0.1c0 0-0.5-4.4-0.5-7V37.9h10.1v41.2h-10.2L374.1 60c-1.6-2.7-3.5-7-3.5-7h-0.1c0 0 0.5 4.4 0.5 7v19.2h-10.1V37.9z" class="a"/><path d="M434.5 46.6H422v-8.7h35.1v8.7h-12.5v32.6h-10.1V46.6z" class="a"/><path d="M502 37.7c9.8 0 14.8 5.4 14.8 5.4l-2.8 4.3c0 0-4.7-4.4-11.8-4.4 -9.1 0-15.1 6.9-15.1 15.6 0 8.7 6.1 16.1 15.1 16.1 7.7 0 12.6-5.3 12.6-5.3l3.1 4.1c0 0-5.6 6.5-15.8 6.5 -12.2 0-20.8-9.3-20.8-21.3C481.2 46.7 490.1 37.7 502 37.7z" class="a"/><path d="M546.8 38.4h12.5c4.3 0 6.1 0.3 7.6 0.9 4.2 1.6 6.9 5.7 6.9 11 0 5.2-2.9 9.6-7.3 11v0.1c0 0 0.5 0.5 1.2 1.8l8.7 15.8h-6.5L561.2 63h-8.7v16.2h-5.7V38.4zM560.7 58c4.4 0 7.2-2.8 7.2-7.4 0-3-1.2-5.1-3.2-6.3 -1.1-0.6-2.4-0.9-5.6-0.9h-6.6V58H560.7z" class="a"/><path d="M604.9 38.4h23.6v5h-17.9v12.7h14.6v5h-14.6v13.1h18.9v5h-24.6V38.4z" class="a"/><path d="M679.3 67.4H664l-4 11.7h-5.9l14.6-40.7h6l14.6 40.7h-5.9L679.3 67.4zM671.6 44c0 0-0.9 3.7-1.6 5.8l-4.6 12.9h12.3l-4.5-12.9c-0.7-2.1-1.6-5.8-1.6-5.8H671.6z" class="a"/><path d="M722.7 43.4h-14v-5h33.6v5h-14v35.8h-5.7V43.4z" class="a"/><path d="M769.4 38.4H793v5h-17.9v12.7h14.6v5h-14.6v13.1H794v5h-24.6V38.4z" class="a"/></svg></a>
</div>
</div>


</div>


<% if @final_charge != 0 %>
<script type="text/javascript" src="/assets/payment-modal.js"></script>
<% end %>

<script type="text/javascript">
  
$(document).ready(function() {


  
  var validator = $("#purchase-tickets_form").validate({
    rules: {
      "purchase[first_name]": {
        required: true
      },
      "purchase[last_name]": {
        required: true
      },
      "purchase[email]": {
        required: true
      },
      "purchase[email]": {
        required: true
      }
    }, messages : {
      "purchase[first_name]": 'Please enter your first name.',
      "purchase[last_name]": 'Please enter your last name.',
      "purchase[email]": 'Please enter a valid email.',

    }
  });
  var attendee_length = $('.ticket-holder').length;
  for(var i=0; i< attendee_length; i++ ) {

  $("input[name='attendees["+ (i+1) +"][first_name]']").rules("add", {required: true, messages: { required: 'Please enter a valid first name'}});
  
  $("input[name='attendees["+ (i+1) +"][last_name]']").rules("add", {required: true, messages: { required: 'Please enter a valid last name'}});
  

  $("input[name='attendees["+ (i+1) +"][email]']").rules("add", {required: true, messages: { required: 'Please enter a valid email'}});
  }

});

</script>


